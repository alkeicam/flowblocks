<html>

<head>
    <!-- these are required by jointjs  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone.js"></script>

    <!-- These are required by the app -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bulma-extensions@6.2.7/dist/js/bulma-extensions.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-extensions@6.2.7/dist/css/bulma-extensions.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rivets/0.9.6/rivets.bundled.min.js"></script>

    <!-- load jointjs  -->
    <script src="https://unpkg.com/jointjs@^3.1"> </script>
    <link rel="stylesheet" href="https://unpkg.com/jointjs@3.1.1/dist/joint.min.css" />
    <link rel="stylesheet" href="./resources/css/flowblocks.css" />
    <!-- SVG pan and zoom support -->
    <script src="https://ariutta.github.io/svg-pan-zoom/dist/svg-pan-zoom.min.js"></script>

    <script src="./resources/js/rivet-utils.js"></script>

    <!-- load flowblocks -->
    <script src="./flowblocks.js"></script>

</head>

<body>

    <div class="flowblocks-flow">
        <div id="flowblocks-flow"></div>
        <div class="modal flowblocks-flow-modal" rv-class-is-active="model.details.show">
            <div class="modal-background"></div>            
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">Configure <span
                            class="has-text-weight-bold is-uppercase">{model.details.label}</span></p>
                    <button class="delete" aria-label="close" rv-on-click="dismiss"></button>
                </header>
                <section class="modal-card-body">
                    <!-- Content ... -->
                    <form>
                        <div class="field">
                            <label class="label">BlockId</label>
                            <div class="control">
                                <input class="input" type="text" placeholder="Block unique id" disabled rv-value="model.details.blockId">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Type</label>
                            <div class="control">
                                <input class="input is-uppercase" type="text" placeholder="BlockType" disabled rv-value="model.details.type">
                            </div>
                        </div>    
                                 
                        <div class="field" rv-each-c="model.details.configurables">
                            <label class="label">{c.label}</label>
                            <div class="control">                                
                                <input rv-if="c.type | eq 'TEXT'" class="input" type="text" rv-placeholder="c.placeholder" rv-data-bid="c.id" rv-value="c.value">
                            </div>
                        </div>
                    </form>
                </section>
                <footer class="modal-card-foot">
                    <button class="button is-success" rv-on-click="detailsSave">Save changes</button>
                    <button class="button" rv-on-click="dismiss">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <div class="flowblocks-toolbar">
        <div id="flowblocks-toolbar"></div>
        <div class="modal flowblocks-toolbar-modal flowblocks-create" rv-class-is-active="model.create.show">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">Create <span
                            class="has-text-weight-bold is-uppercase">{model.create.title}</span></p>
                    <button class="delete" aria-label="close" rv-on-click="dismiss"></button>
                </header>
                <section class="modal-card-body">
                    <!-- Content ... -->
                    <form>
                        <div class="field">
                            <label class="label">BlockId</label>
                            <div class="control">
                                <input class="input" type="text" placeholder="Block unique id" rv-value="model.create.blockId">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Label</label>
                            <div class="control">
                                <input class="input" type="text" placeholder="Label displayed on block" rv-value="model.create.label">
                            </div>
                        </div>
                    </form>
                </section>
                <footer class="modal-card-foot">
                    <button class="button is-success" rv-on-click="addBlock">Save changes</button>
                    <button class="button" rv-on-click="dismiss">Cancel</button>
                </footer>
            </div>
            <!-- <button class="modal-close is-large" aria-label="close" rv-on-click="dismiss"></button> -->
        </div>
    </div>
    <script>
        var flow = flowblocks.createFlow('flowblocks-flow');
        var toolbar = flowblocks.createToolbar('flowblocks-toolbar');
        var app = flowblocks.createApp('flowblocks-flow', 'flowblocks-toolbar');

        flowblocks.registerType('StartNode','Start','tequila', 'cream', {
            configurables: [
                {id: 'pKernelSize', label: 'Kernel Size', placeholder: 'Kernel size', type: 'TEXT', required: false},
                {id: 'pActivation', label: 'Activation', placeholder: 'relu | softmax', type: 'TEXT', required: false},        
                {id: 'pFilters', label: 'Filters', placeholder: 'number', type: 'TEXT', required: false}                    
            ]
        });
        flowblocks.registerType('ForwardSplit','Split','jam', 'cream');
        flowblocks.registerType('Forward','PassThrough', 'rug', 'cream');
        flowblocks.registerType('Mixer','Mixer', 'cactus', 'cream');
        flowblocks.registerType('Join','Join','sun', 'cream');
        flowblocks.registerType('FlowEnd','End', 'zampona', 'cream');

        flowblocks.enablePanAndZoom(svgPanZoom);

        flowblocks.on('all', function(a,b,c,d,e,f){
            console.log('Received: ',a,b,c,d,e,f);
        })
    </script>


</body>

</html>