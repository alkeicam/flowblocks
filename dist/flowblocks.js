!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("joint")):"function"==typeof define&&define.amd?define(["joint"],e):"object"==typeof exports?exports.flowblocks=e(require("joint")):t.flowblocks=e(t.joint)}(this,(function(t){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(e,i){e.exports=t},function(t,e,i){i(0);t.exports=new class{linkGetParticipants(t,e){if(t.isLink())return{sourceElement:e.graph.getCell(t.get("source").id),sourcePort:t.get("source").port,targetElement:e.graph.getCell(t.get("target").id),targetPort:t.get("target").port}}getElementByClass(t){if(document){var e=document.getElementsByClassName(t);if(e.length>0)return e[0]}}}({})},function(t,e){t.exports=new class{constructor(t){this.SIZE={width:70,height:70},this.POSITION={x:40,y:20},this.POSITION_DELTA={dx:50,dy:50},this.STYLE="americana",this.STYLES={americana:{bodyColor:"#74b9ff",titleBarColor:"#ffeaa7",statusBarColor:"#fdcb6e",portInColor:"#00cec9",portOutColor:"#ff7675",validationERRORColor:"#d63031",validationOKColor:"#00b894"},original:{bodyColor:"#3DB5FF",titleBarColor:"rgb(255, 230, 206)",statusBarColor:"rgb(209, 226, 208)",portInColor:"#16A085",portOutColor:"#E74C3C",validationERRORColor:"#950952",validationOKColor:"#008D83"},cream:{bodyColor:"#FAE8FF",titleBarColor:"#E1C2ED",statusBarColor:"#E1C2ED",portInColor:"#936DED",portOutColor:"#F2EAD7",validationERRORColor:"#950952",validationOKColor:"#008D83"}},this.TOOLBAR={SIZE:{width:120,height:960},PADDING:{x:20,y:20},ROW_PADDING:30,FONT:{SIZE:.15,FAMILY:"Helvetica",WEIGHT:"bold"}}}}({})},function(t,e){t.exports=new class{constructor(t){this.EVENTS={TOOLBAR_ITEM_DBLCLICK:"toolbar-item:dblclick"}}allEvents(){var t=[];return Object.keys(this.EVENTS).forEach(e=>{t.push(this.EVENTS[e])}),t}}({})},function(t,e,i){i(0),i(1);const r=i(5),o=i(6),s=i(7),n=i(8),a=i(3),l=i(9),c=i(10);t.exports=new class{constructor(t){this.options={},Object.assign(this.options,t),this._registeredTypes={},this.flow=void 0,this.toolbar=void 0,this.emitter=new l,this._initialize()}_initialize(){}registerType(t,e,i,r,o){return this._registeredTypes[t]={name:t,statusDefinition:e,template:i,style:o,icon:r},this.createToolbarItem(t,t),this._registeredTypes[t]}createFlow(t){return this.flow=o.create(t,this.emitter),this.flow}createToolbar(t){return this.toolbar=s.create(t,this.emitter),this.toolbar}createApp(t,e){c.create(this,this.emitter,t,e)}getBlock(t){return this.flow._blocks.find(e=>e.get("blockId")==t)}on(t,e){"all"==t?a.allEvents().forEach(t=>{this.emitter.on(t,e)}):this.emitter.on(t,e)}createToolbarItem(t,e,i){if(this.toolbar){var r=this._registeredTypes[t];if(r){var o=n.createBlank(r.template,r.statusDefinition,r.style);return o.set("name",e),o.set("_type",r.name),i&&o.set("size",i),r.icon&&(-1==r.icon.lastIndexOf("/")?o.set("icon","https://unpkg.com/flowblocks/dist/resources/img/svg/"+r.icon+".svg"):o.set("icon",r.icon)),this.toolbar.addItem(o),o}throw new Error("Undefined type exception:"+t+". Please register type first with registerType().")}console.error("Cant create toolbar item. Create toolbar first by calling createToolbar().")}createBlock(t,e,i,o,s){var n=this._registeredTypes[t];if(n){var a=r.createBlank(i,n.template,n.statusDefinition,n.style);if(a.set("name",e),a.set("_type",n.name),i)this.flow._blocks.find(t=>t.get("blockId")==i)&&console.error("Duplicate flow Block for id: "+i);return o&&a.set("position",o),s&&a.set("size",s),n.icon&&(-1==n.icon.lastIndexOf("/")?a.set("icon","https://unpkg.com/flowblocks/dist/resources/img/svg/"+n.icon+".svg"):a.set("icon",n.icon)),this.flow.addBlock(a),a}throw new Error("Undefined type exception:"+t+". Please register type first with registerType().")}_dumpConnections(){this.flow._blocks.forEach(t=>{t._dumpConnections()})}enablePanAndZoom(t){if(t)try{this.flow.enablePanAndZoom(t)}catch(t){console.error(t)}}}({})},function(t,e,i){const r=i(0),o=i(2);t.exports=new class{constructor(t){this.options={defaultSize:o.SIZE,defaultPosition:o.POSITION,defaultPositionDelta:o.POSITION_DELTA},this.Model={},this.View={},Object.assign(this.options,t),this._initialize()}_initialize(){r.shapes.flowblocks={},this.Model=r.shapes.devs.Model.define("flowblocks.Block",{name:"",icon:"./resources/img/svg/agave.svg",status:"ERROR",statusMsg:"OK",blockId:void 0,debug:!0,errors:[],_style:void 0,_defaultStyle:o.STYLE,_styles:o.STYLES,_portsConnected:0,_type:void 0,_portConnections:[],attrs:{rect:{fill:"rgb(211, 55, 255)"},body:{fill:"#ffffff",stroke:"#000000"},link:{refWidth:"100%",refHeight:"100%",xlinkShow:"new",cursor:"pointer"},".status-err":{refHeight:"25%",fill:"rgb(204, 41, 0)",refY:"75%"},".fb-icon-rect":{"ref-width":"100%",fill:"#3DB5FF"},".fb-icon-image":{ref:".fb-icon-rect"},".fb-status-rect":{"ref-width":"100%",fill:"rgb(209, 226, 208)"},".fb-status-text":{ref:".fb-status-rect","text-anchor":"start",fill:"black","y-alignment":"middle"},".fb-label-rect":{"ref-width":"100%",fill:"rgb(255, 230, 206)"},".fb-validation-rect":{fill:"#d63031"},".fb-label-text":{ref:".fb-label-rect","text-anchor":"start",fill:"black","y-alignment":"middle"}}},{markup:['<g class="rotatable">','<rect class="body"/>','<rect class="fb-icon-rect"/>','<image class="fb-icon-image" href="//resources/img/svg/agave.svg" />','<rect class="fb-label-rect"/>','<text class="fb-label-text">Label</text>','<rect class="fb-status-rect"/>','<text class="fb-status-text"></text>','<rect class="fb-validation-rect"/>',"</g>"].join(""),initialize:function(){this.on("change:name change:icon change:status change:statusMsg change:size",(function(){this._updateMyModel(),this.trigger("flowblocks-block-update")}),this),this._updateMyModel(),r.shapes.devs.Model.prototype.initialize.apply(this,arguments)},api:function(){return["element.set('name','my label');","element.set('position', {x:30, y:10});","element.set('size', {width:50, height: 50});","element.set('icon', 'https://unpkg.com/flowblocks/dist/resources/img/svg/vase.svg');","element.style({titleBarColor: '#FADB50'});","element.getStatus();","element.freePorts();"]},getStatus(){return{valid:"OK"==this.get("status"),errors:this.get("errors")}},style(t){if(t)if("string"==typeof t||t instanceof String){var e=this.get("_styles")[t.toLocaleLowerCase()];e&&this.style(e)}else this.set("_style",t),t.bodyColor&&this.attr(".fb-icon-rect/fill",t.bodyColor),t.titleBarColor&&this.attr(".fb-label-rect/fill",t.titleBarColor),t.statusBarColor&&this.attr(".fb-status-rect/fill",t.statusBarColor),t.portInColor&&this.getPorts().forEach(e=>{"in"==e.group&&this.portProp(e.id,"attrs/circle/fill",t.portInColor)}),t.portOutColor&&this.getPorts().forEach(e=>{"out"==e.group&&this.portProp(e.id,"attrs/circle/fill",t.portOutColor)});else this.style(this.get("_defaultStyle"))},freePorts(t){var e=this.getPorts().filter(e=>!t||e.group==t),i=this.get("_portConnections"),r=[];return e.forEach(t=>{i.find(e=>e.port==t.id)||r.push(t)}),r},_dumpConnections(){this.get("debug")&&console.log("Connections["+this.get("blockId")+"]: ",JSON.stringify(this.get("_portConnections")))},_recalculateStatus(){this.set("status","OK"),this.get("errors").length=0;var t=this.freePorts();t.length>0?(this.set("status","ERROR"),this.attr(".fb-validation-rect/fill",this.get("_style").validationERRORColor),t.forEach(t=>{this.get("errors").push({code:"PORT_NOT_CONNECTED",cId:t.id,msg:"Port ["+t.id+"] is not connected"})})):(this.set("status","OK"),this.get("errors").length=0,this.attr(".fb-validation-rect/fill",this.get("_style").validationOKColor))},_handleDelete(t){var e=this.get("_portConnections").filter(e=>e.id!=t);this.set("_portConnections",e),this._recalculateStatus()},_handleDisconnect(t,e,i){if(null!=t){this.get("_portConnections").find(r=>r.port==e&&r.id==t.id&&r.linkId==i);var r=this.get("_portConnections").findIndex(r=>r.port==e&&r.id==t.id&&r.linkId==i);r>=0&&this.get("_portConnections").splice(r,1),this._recalculateStatus()}},_handleConnectFrom(t,e,i,r){var o={port:e,id:t.get("id"),bId:t.get("blockId"),type:t.get("_type"),targetPort:i,linkId:r};this.get("_portConnections").push(o),this._recalculateStatus()},_handleConnectTo(t,e,i,r){var o={port:e,id:t.get("id"),bId:t.get("blockId"),type:t.get("_type"),targetPort:i,linkId:r};this.get("_portConnections").push(o),this._recalculateStatus()},_recalculateRectWithLabel:function(t,e,i,r,o,s){this.get("attrs");var n=i*o.height,a=r*n,l=s+n/2,c=.1*o.width;return this.attr(t+"-rect/height",n),this.attr(t+"-rect/transform","translate(0,"+s+")"),this.attr(t+"-text/font-size",a),this.attr(t+"-text/transform","translate("+c+","+l+")"),this.attr(t+"-text/text",e),n},_recalculateValidationRect:function(t,e,i,r,o){this.get("attrs");var s=e*r.height,n=(1-i)*r.width,a=i*r.width;return this.attr(t+"-rect/height",s),this.attr(t+"-rect/width",a),this.attr(t+"-rect/transform","translate("+n+","+o+")"),this.attr(t+"-rect/title","Block validation state: "+this.get("status")),s},_recalculateRectWithIcon:function(t,e,i,r,o,s){var n=i*o.height;this.attr(t+"-rect/height",n),this.attr(t+"-rect/transform","translate(0,"+s+")");var a=r*n,l=o.width/2-a/2,c=s+n/2-a/2;return this.attr(t+"-image/height",a),this.attr(t+"-image/transform","translate("+l+","+c+")"),this.attr(t+"-image/href",e),n},_enableRemoval(t){var e=this.findView(t),i=e.getBBox().width-this.getBBox().width,r=this.getPorts(),o=!1,s=!1;r.forEach(t=>{"out"==t.group&&(s=!0),"in"==t.group&&(o=!0)}),i=o&&s?-i/2:s?-i:0;var n=new joint.elementTools.Remove({focusOpacity:.5,rotate:!0,x:"100%",offset:{x:i,y:0}}),a=new joint.dia.ToolsView({name:"basic-tools",tools:[n]});e.addTools(a),e.hideTools()},_updateMyModel:function(){var t=0,e={width:this.get("size").width,height:this.get("size").height,icon:this.get("icon"),name:this.get("debug")?this.get("name")+"["+this.get("blockId")+"]":this.get("name"),statusMessage:this.get("statusMsg"),status:this.get("status")};t+=this._recalculateRectWithLabel(".fb-label",e.name,.2,.6,e,t);var i=t+=this._recalculateRectWithIcon(".fb-icon",e.icon,.6,.8,e,t);t+=this._recalculateRectWithLabel(".fb-status",e.statusMessage,.2,.3,e,t),this._recalculateValidationRect(".fb-validation",.2,.15,e,i)}},{}),r.shapes.flowblocks.BlockView=r.dia.ElementView.extend({initialize:function(){r.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"flowblocks-block-update",(function(){this.update(),this.resize()}))}}),this.View=r.shapes.flowblocks.BlockView}createBlank(t,e,i,r){var o={PassThrough:this.createPassThroughElement,Start:this.createStartElement,Split:this.createSplitElement,Join:this.createJoinElement,End:this.createSinkElement};if(o[e]){var s=o[e].call(this,"",i);return s.set("blockId",t),s.style(r),s._recalculateStatus(),s}throw new Error("Unsuported template: "+e)}_createBaseOptions(){return{position:this.options.defaultPosition,size:this.options.defaultSize,ports:{groups:{in:{attrs:{".port-body":{fill:"#16A085",magnet:"passive"}}},out:{attrs:{".port-body":{fill:"#E74C3C"}}}}},attrs:{".label":{text:"Model","ref-x":.5,"ref-y":.2},rect:{fill:"#2ECC71"}}}}createSplitElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["in1"],r.outPorts=["out1","out2"],new this.Model(r)}createJoinElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["in1","in2"],r.outPorts=["out1"],new this.Model(r)}createPassThroughElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["in1"],r.outPorts=["out1"],new this.Model(r)}createStartElement(t,e,i){var r=this._createBaseOptions();return r.outPorts=["out1"],new this.Model(r)}createSinkElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["in1"],new this.Model(r)}}({})},function(t,e,i){const r=i(0),o=i(1);t.exports=new class{constructor(t){this.options={},this.graph={},this.paper={},this._blocks=[],Object.assign(this.options,t),this._initialize(),this.emitter=void 0}_initialize(){}create(t,e){return this.emitter=e,this.graph=new r.dia.Graph,this.paper=new r.dia.Paper({el:document.getElementById(t),width:1400,height:960,gridSize:1,model:this.graph,snapLinks:!0,linkPinning:!1,embeddingMode:!0,clickThreshold:5,defaultLink:new r.dia.Link({attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"},".connection":{stroke:"blue"},".marker-source":{d:"M 15 0 L 0 5 L 15 15 z",opacity:"0",stroke:"orange"},'.marker-arrowhead[end="source"]':{fill:"red",d:"M 10 0 L 0 5 L 10 10 z",opacity:"0"}}}),defaultConnectionPoint:{name:"boundary"},highlighting:{default:{name:"stroke",options:{padding:6}},embedding:{name:"addClass",options:{className:"highlighted-parent"}}},validateEmbedding:function(t,e){return e.model instanceof r.shapes.devs.Coupled},validateConnection:function(t,e,i,r,o,s){t.model;var n=!!i.model.freePorts("in").find(t=>t.id==r.getAttribute("port"));return e!=r&&"in"==r.getAttribute("port-group")&&t!=i&&n},validateMagnet:function(t,e,i){return"passive"!=e.getAttribute("magnet")&&t.model.freePorts("out").length>0}}),joint.dia.Link.prototype.toolMarkup=['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>","</g>"].join(""),this._bindConnectionEvents(),this._bindToolsEvents(),this}_bindToolsEvents(){this.paper.on("element:mouseenter",(function(t){t.showTools()})),this.paper.on("element:mouseleave",(function(t){t.hideTools()}))}_bindConnectionEvents(){var t=this;this.paper.on("link:connect",(function(e,i,r,s,n){var a=o.linkGetParticipants(e.model,t),l=a.sourceElement,c=a.targetElement,h=a.sourcePort,d=a.targetPort;r.model,s.getAttribute("port");l._handleConnectTo(c,h,d,e.model.id),c._handleConnectFrom(l,d,h,e.model.id)})),this.paper.on("link:disconnect",(function(e,i,r,s,n){var a=o.linkGetParticipants(e.model,t),l=a.sourceElement,c=r.model,h=(a.targetPort,a.sourcePort);a.targetElement;null!=c&&null!=l&&(l._handleDisconnect(c,h,e.model.id),c._handleDisconnect(l,s.getAttribute("port"),e.model.id))})),this.graph.on("remove",(function(e){if(e.isLink()){var i=o.linkGetParticipants(e,t),r=i.sourceElement,s=i.targetElement,n=i.sourcePort,a=i.targetPort;null!=s&&null!=r&&(r._handleDisconnect(s,n,e.id),s._handleDisconnect(r,a,e.id))}else{var l=e;t._blocks=t._blocks.filter(t=>t.id!=l.id),t._blocks.forEach(t=>{t._handleDelete(l)})}}))}addBlock(t){this._blocks.push(t),this.graph.addCell(t),t._enableRemoval(this.paper)}enablePanAndZoom(t){var e=t(document.querySelector("[joint-selector=svg]"),{fit:!1,panEnabled:!1,controlIconsEnabled:!0,center:!1,dblClickZoomEnabled:!1,minZoom:.3});this.paper.on("blank:pointerdown",(function(t,i,r){e.enablePan()})),this.paper.on("cell:pointerup blank:pointerup",(function(t,i){e.disablePan()}))}validate(){var t=!0,e=[];return this._blocks.forEach(i=>{var r=i.getStatus();r.valid||e.push({blockId:i.get("blockId"),errors:r.errors}),t=t&&r.valid}),{valid:t,errorBlocks:e}}}({})},function(t,e,i){const r=i(0),o=i(2),s=i(3);t.exports=new class{constructor(t){this.options={size:o.TOOLBAR.SIZE,padding:o.TOOLBAR.PADDING,rowPadding:o.TOOLBAR.ROW_PADDING},this.graph={},this.paper={},this._items=[],this.emitter=void 0,Object.assign(this.options,t),this._initialize()}_initialize(){}create(t,e){return this.emitter=e,this.graph=new r.dia.Graph,this.paper=new r.dia.Paper({el:document.getElementById(t),width:this.options.size.width,height:this.options.size.height,gridSize:1,model:this.graph,background:{color:"transparent"},interactive:{addLinkFromMagnet:!1,elementMove:!1},snapLinks:!1,linkPinning:!1,embeddingMode:!1,clickThreshold:5,defaultConnectionPoint:{name:"boundary"},validateConnection:function(t,e,i,r,o,s){return!1}}),this._bindEvents(),this}addItem(t){this._resizeItem(t),this._items.push(t),this.graph.addCell(t),this._repositionItems()}_resizeItem(t){var e=this.options.size.width,i=2*this.options.padding.x,r=e-(i*=1.2);t.set("size",{width:r,height:r})}_bindEvents(){var t=this;this.paper.on("element:pointerdblclick",(function(e,i){var r=e.model.get("_type");t.emitter.emit(s.EVENTS.TOOLBAR_ITEM_DBLCLICK,r,i)}))}_repositionItems(){var t={x:20,y:20};this._items.forEach(e=>{var i=e.findView(this.paper),r={x:t.x,y:t.y+i.getBBox().height/6};e.set("position",r),t={x:r.x,y:r.y+i.getBBox().height}})}}({})},function(t,e,i){const r=i(0),o=i(2);t.exports=new class{constructor(t){this.options={defaultSize:o.SIZE,defaultPosition:o.POSITION,defaultPositionDelta:o.POSITION_DELTA},this.Model={},this.View={},Object.assign(this.options,t),this._initialize()}_initialize(){r.shapes.flowblocks.toolbar={},this.Model=r.shapes.devs.Model.define("flowblocks.toolbar.BlockToolbarItem",{name:"",icon:"./resources/img/svg/agave.svg",debug:!0,_style:void 0,_defaultStyle:o.STYLE,_styles:o.STYLES,_type:void 0,attrs:{rect:{fill:"rgb(211, 55, 255)"},body:{fill:"#ffffff",stroke:"#000000"},link:{refWidth:"100%",refHeight:"100%",xlinkShow:"new",cursor:"pointer"},".status-err":{refHeight:"25%",fill:"rgb(204, 41, 0)",refY:"75%"},".fb-icon-rect":{"ref-width":"100%",fill:"#3DB5FF"},".fb-icon-image":{ref:".fb-icon-rect"},".fb-status-rect":{"ref-width":"100%",fill:"rgb(209, 226, 208)"},".fb-status-text":{ref:".fb-status-rect","text-anchor":"start",fill:"black","y-alignment":"middle"},".fb-label-rect":{"ref-width":"100%",fill:"rgb(255, 230, 206)"},".fb-validation-rect":{fill:"#d63031"},".fb-label-text":{ref:".fb-label-rect","text-anchor":"start",fill:"black","y-alignment":"middle"},".fb-tool-label-text":{"text-anchor":"start",fill:"black","y-alignment":"middle"}}},{markup:['<g class="rotatable">','<rect class="body"/>','<rect class="fb-icon-rect"/>','<image class="fb-icon-image" href="//resources/img/svg/agave.svg" />','<rect class="fb-label-rect"/>','<text class="fb-label-text">Label</text>','<rect class="fb-status-rect"/>','<text class="fb-tool-label-text"></text>',"</g>"].join(""),initialize:function(){this.on("change:name change:icon change:status change:statusMsg change:size",(function(){this._updateMyModel(),this.trigger("flowblocks-block-toolbar-item-update")}),this),this._updateMyModel(),r.shapes.devs.Model.prototype.initialize.apply(this,arguments)},style(t){if(t)if("string"==typeof t||t instanceof String){var e=this.get("_styles")[t.toLocaleLowerCase()];e&&this.style(e)}else this.set("_style",t),t.icon&&this.set("icon",t.icon),t.bodyColor&&this.attr(".fb-icon-rect/fill",t.bodyColor),t.titleBarColor&&this.attr(".fb-label-rect/fill",t.titleBarColor),t.statusBarColor&&this.attr(".fb-status-rect/fill",t.statusBarColor),t.portInColor&&this.getPorts().forEach(e=>{"in"==e.group&&this.portProp(e.id,"attrs/circle/fill",t.portInColor)}),t.portOutColor&&this.getPorts().forEach(e=>{"out"==e.group&&this.portProp(e.id,"attrs/circle/fill",t.portOutColor)});else this.style(this.get("_defaultStyle"))},_recalculateRectWithLabel:function(t,e,i,r,o,s){this.get("attrs");var n=i*o.height,a=r*n,l=s+n/2,c=.1*o.width;return this.attr(t+"-rect/height",n),this.attr(t+"-rect/transform","translate(0,"+s+")"),this.attr(t+"-text/font-size",a),this.attr(t+"-text/transform","translate("+c+","+l+")"),this.attr(t+"-text/text",e),n},_recalculateToolLabel:function(t,e,i,r){var s=i.height*o.TOOLBAR.FONT.SIZE,n=r+s;this.attr(t+"-text/font-size",s),this.attr(t+"-text/transform","translate(0,"+n+")"),this.attr(t+"-text/text",e),this.attr(t+"-text/font-family",o.TOOLBAR.FONT.FAMILY),this.attr(t+"-text/font-weight",o.TOOLBAR.FONT.WEIGHT)},_recalculateValidationRect:function(t,e,i,r,o){this.get("attrs");var s=e*r.height,n=(1-i)*r.width,a=i*r.width;return this.attr(t+"-rect/height",s),this.attr(t+"-rect/width",a),this.attr(t+"-rect/transform","translate("+n+","+o+")"),this.attr(t+"-rect/title","Block validation state: "+this.get("status")),s},_recalculateRectWithIcon:function(t,e,i,r,o,s){var n=i*o.height;this.attr(t+"-rect/height",n),this.attr(t+"-rect/transform","translate(0,"+s+")");var a=r*n,l=o.width/2-a/2,c=s+n/2-a/2;return this.attr(t+"-image/height",a),this.attr(t+"-image/transform","translate("+l+","+c+")"),this.attr(t+"-image/href",e),n},_updateMyModel:function(){var t=0,e={width:this.get("size").width,height:this.get("size").height,icon:this.get("icon"),name:this.get("name"),statusMessage:this.get("statusMsg"),status:this.get("status")};t+=this._recalculateRectWithLabel(".fb-label","Block",.2,.6,e,t),t+=this._recalculateRectWithIcon(".fb-icon",e.icon,.6,.8,e,t),t+=this._recalculateRectWithLabel(".fb-status",e.statusMessage,.2,.3,e,t),this._recalculateToolLabel(".fb-tool-label",e.name,e,t)}},{}),r.shapes.flowblocks.toolbar.BlockToolbarItemView=r.dia.ElementView.extend({initialize:function(){r.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"flowblocks-block-toolbar-item-update",(function(){this.update(),this.resize()}))}}),this.View=r.shapes.flowblocks.toolbar.BlockToolbarItemView}createBlank(t,e,i){var r={PassThrough:this.createPassThroughElement,Start:this.createStartElement,Split:this.createSplitElement,Join:this.createJoinElement,End:this.createSinkElement};if(r[t]){var o=r[t].call(this,"",e);return o.style(i),o}throw new Error("Unsuported template: "+t)}_createBaseOptions(){return{position:this.options.defaultPosition,size:this.options.defaultSize,ports:{groups:{in:{attrs:{".port-body":{fill:"#16A085",magnet:"passive"},".port-label":{display:"none"}}},out:{attrs:{".port-body":{fill:"#E74C3C",magnet:"passive"},".port-label":{display:"none"}}}}},attrs:{".label":{text:"Model","ref-x":.5,"ref-y":.2},rect:{fill:"#2ECC71"}}}}createSplitElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["i1"],r.outPorts=["o1","o2"],new this.Model(r)}createJoinElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["i1","i2"],r.outPorts=["o1"],new this.Model(r)}createPassThroughElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["i1"],r.outPorts=["o1"],new this.Model(r)}createStartElement(t,e,i){var r=this._createBaseOptions();return r.outPorts=["o1"],new this.Model(r)}createSinkElement(t,e,i){var r=this._createBaseOptions();return r.inPorts=["i1"],new this.Model(r)}}({})},function(t,e,i){"use strict";var r,o="object"==typeof Reflect?Reflect:null,s=o&&"function"==typeof o.apply?o.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function d(t,e,i,r){var o,s,n,a;if(c(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),n=s[e]),void 0===n)n=s[e]=i,++t._eventsCount;else if("function"==typeof n?n=s[e]=r?[i,n]:[n,i]:r?n.unshift(i):n.push(i),(o=h(t))>0&&n.length>o&&!n.warned){n.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=n.length,a=l,console&&console.warn&&console.warn(a)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},o=u.bind(r);return o.listener=i,r.wrapFn=o,o}function p(t,e,i){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?i?[o.listener||o]:[o]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(o):b(o,o.length)}function g(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function b(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");l=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var n;if(e.length>0&&(n=e[0]),n instanceof Error)throw n;var a=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw a.context=n,a}var l=o[t];if(void 0===l)return!1;if("function"==typeof l)s(l,this,e);else{var c=l.length,h=b(l,c);for(i=0;i<c;++i)s(h[i],this,e)}return!0},a.prototype.addListener=function(t,e){return d(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return d(this,t,e,!0)},a.prototype.once=function(t,e){return c(e),this.on(t,f(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,f(this,t,e)),this},a.prototype.removeListener=function(t,e){var i,r,o,s,n;if(c(e),void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(o=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){n=i[s].listener,o=s;break}if(o<0)return this;0===o?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,o),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,n||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var o,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(o=s[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},a.prototype.listeners=function(t){return p(this,t,!0)},a.prototype.rawListeners=function(t){return p(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):g.call(t,e)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,i){const r=i(1),o=i(3);t.exports=new class{constructor(t){this.emmiter=void 0,this.flowClass=void 0,this.toolbarClass=void 0,this.flowblocks=void 0,this.flowController={},this.toolbarController=void 0}create(t,e,i,r){this.flowClass=i,this.toolbarClass=r,this.flowblocks=t,this._toolbarController(),this._rivetize(),this._bindEvents(t)}_toolbarController(){this.toolbarController={parent:this,model:{create:{show:!1,title:"",type:void 0,label:void 0,blockId:void 0}},dismiss:function(t,e){e.model.create.show=!1},addBlock:function(t,e){e.parent.flowblocks.createBlock(e.model.create.type,e.model.create.label,e.model.create.blockId),e.resetCreate()},resetCreate(){this.model.create.type=void 0,this.model.create.show=!1,this.model.create.title="",this.model.create.label=void 0,this.model.create.blockId=void 0}}}_rivetize(){if(window&&window.rivets){var t=r.getElementByClass(this.flowClass),e=r.getElementByClass(this.toolbarClass);window.rivets.bind(t,this.flowController),window.rivets.bind(e,this.toolbarController)}else console.warn("For full interactivity rivets is required.")}_bindEvents(t){var e=this;t.on("all",(function(t){})),t.on(o.EVENTS.TOOLBAR_ITEM_DBLCLICK,(function(t){e.toolbarController.model.create.title=t,e.toolbarController.model.create.show=!0,e.toolbarController.model.create.type=t}))}}({})}])}));